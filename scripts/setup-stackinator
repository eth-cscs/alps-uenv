# to be sourced from stack-build

tool_base_path="$(pwd)"
# check out a unique copy of stackinator for each ci task, so that
# builds in the same pipeline do not conflict
#tool_path="${tool_base_path}/stackinator-${build_id}"
tool_path=`mktemp -d`
tool_repo=https://github.com/eth-cscs/stackinator.git
tool_version=6e269ae39618ad01fa7696fb6c859577f0d5fd1b

#if [ ! -d "${tool_path}" ]; then
    log "installing stackinator from git in '${tool_path}'"

    log "cloning git repository ${tool_repo}"
    git clone --quiet "${tool_repo}" "${tool_path}" || err "unable to clone stackinator git repository"

    log "checkout stackinator ${tool_version}"
    cd "${tool_path}"
    git checkout --quiet "${tool_version}" || err "unable to checkout out requested version"

    log "bootstrap stackinator"
    cd "${tool_path}"
    ./bootstrap.sh || err "bootstrap failed"

    cd "${tool_base_path}"
    log "finished stackinator installation"
#fi

export PATH="${tool_path}/bin:$PATH"
